{Spin2_v45}
'' =================================================================================================
''
''   File....... SD_RT_fstr_tests.spin2
''   Purpose.... Test serial fstr1-fstr6 mechanism (isolate garbage output bug)
''   Authors.... Claude + Stephen M Moraco
''   Started.... FEB 2026
''
'' =================================================================================================
''
''   Tests fstr1 through fstr6 with simple inline strings.
''   If fstr3/fstr5/fstr6 produce garbage but fstr1/fstr2 work,
''   the bug is in the fstr mechanism (not the argument values).
''
'' =================================================================================================

CON

  CLK_FREQ = 270_000_000
  _clkfreq = CLK_FREQ

  BR_TERM  = 2_000_000

  PGM_RX   = 63
  PGM_TX   = 62


OBJ

  serial : "isp_serial_singleton"


PUB go() | i

  serial.start(BR_TERM)
  waitms(100)

  serial.fstr0(@"============================================================\r\n")
  serial.fstr0(@"  fstr Mechanism Test\r\n")
  serial.fstr0(@"  Tests fstr1 through fstr6 with inline strings\r\n")
  serial.fstr0(@"============================================================\r\n")
  serial.fstr0(@" \r\n")

  ' === Test fstr1 (known working) ===
  serial.fstr0(@"--- fstr1 tests ---\r\n")
  serial.fstr1(@"  string: [%s]\r\n", @"hello")
  serial.fstr1(@"  number: [%d]\r\n", 42)
  serial.fstr1(@"  hex:    [%.8x]\r\n", $DEADBEEF)
  serial.fstr0(@" \r\n")

  ' === Test fstr2 (known working) ===
  serial.fstr0(@"--- fstr2 tests ---\r\n")
  serial.fstr2(@"  two strings: [%s] [%s]\r\n", @"aaa", @"bbb")
  serial.fstr2(@"  string+num:  [%s] [%d]\r\n", @"hello", 42)
  serial.fstr0(@" \r\n")

  ' === Test fstr3 (NEVER TESTED) ===
  serial.fstr0(@"--- fstr3 tests ---\r\n")
  serial.fstr3(@"  three: [%s] [%d] [%s]\r\n", @"aaa", 42, @"bbb")
  serial.fstr3(@"  nums:  [%d] [%d] [%d]\r\n", 10, 20, 30)
  serial.fstr0(@" \r\n")

  ' === Test fstr4 (NEVER TESTED) ===
  serial.fstr0(@"--- fstr4 tests ---\r\n")
  serial.fstr4(@"  four: [%s] [%d] [%s] [%d]\r\n", @"aaa", 42, @"bbb", 99)
  serial.fstr0(@" \r\n")

  ' === Test fstr5 (NEVER TESTED) ===
  serial.fstr0(@"--- fstr5 tests ---\r\n")
  serial.fstr5(@"  five: [%s] [%d] [%s] [%d] [%s]\r\n", @"aa", 1, @"bb", 2, @"cc")
  serial.fstr0(@" \r\n")

  ' === Test fstr6 (NEVER TESTED) ===
  serial.fstr0(@"--- fstr6 tests ---\r\n")
  serial.fstr6(@"  six: [%s] [%s] [%s] [%d] [%s] [%s]\r\n", @"aa", @"bb", @"cc", 42, @"dd", @"ee")
  serial.fstr0(@" \r\n")

  ' === Test fstr7 (NEVER TESTED) ===
  serial.fstr0(@"--- fstr7 tests ---\r\n")
  serial.fstr7(@"  seven: [%s] [%s] [%s] [%d] [%s] [%s] [%d]\r\n", @"aa", @"bb", @"cc", 42, @"dd", @"ee", 99)
  serial.fstr0(@" \r\n")

  serial.fstr0(@"============================================================\r\n")
  serial.fstr0(@"  fstr mechanism test complete\r\n")
  serial.fstr0(@"============================================================\r\n")
  serial.fstr0(@" \r\n")
  serial.fstr0(@"END_SESSION\r\n")
