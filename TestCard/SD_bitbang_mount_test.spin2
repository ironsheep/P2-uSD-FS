'' =================================================================================================
''
''   File....... SD_bitbang_mount_test.spin2
''   Purpose.... Verify bit-bang driver mount() works correctly
''   Author..... Claude + Stephen M Moraco
''   Started.... JAN 2026
''
'' =================================================================================================

CON

    _CLKFREQ        = 320_000_000

    ' Pin configuration for P2 Edge with SD card
    SD_CS   = 60
    SD_MOSI = 59
    SD_MISO = 58
    SD_SCK  = 61

OBJ
    sd : "SD_card_driver_bitbang"

PUB go() | result

    debug(" ")
    debug("======================================================")
    debug("  Bit-Bang Driver Mount Test")
    debug("======================================================")
    debug(" ")

    debug("Attempting to mount SD card...")
    result := sd.mount(SD_CS, SD_MOSI, SD_MISO, SD_SCK)

    if result
        debug("SUCCESS: Card mounted!")
        debug("Volume label: ", zstr_(sd.volumeLabel()))
        sd.unmount()
        debug("Card unmounted")
    else
        debug("FAILED: Mount returned false")
        debug("Error code: ", sdec_(sd.error()))

    debug(" ")
    debug("END_SESSION")
